# Locks
For the following to make sense, it's recommended to study up on [Evennia's default Lock System](https://www.evennia.com/docs/latest/Components/Locks.html) before reading this.

# The Problem(TM)
Although Evennia's lock system is brilliant in a number of ways, it has some shortcomings to work through. Those being... Evennia's lock systems are stored as encoded strings on objects. The locks are used for anything and everything from who can login as a character to who can edit things. The strings, once set, are static and cannot be changed en masse; there is no mechanism with which to logically group objects together in a way to link their permissions, no way to set defaults which will take effect instantly for anything USING those defaults. Athanor does not provide the logical groupings mechanism but it does alter the lock system to be friendly to such. If you want the actual groupings mechanism too, check out athanor_zones.

# AthanorAccess Mixin
In `athanor/typeclasses/mixin.py` is the `AthanorAccess` Mixin. This is a simple Mixin that substantially enhances the functionality of Evennia's default Lock system. It does this by using an alternate LockHandler on self.locks and adding several more features, explained below.

## access_type in kwargs
The AthanorLockHandler always calls lockfuncs with the access_type being checked as a kwarg. This makes writing complex indirect locking systems more convenient.

## access method
Locks now are checked in the following way. A number of steps are tried. Once one returns True, no further steps are attempted. If none return True, the lock fails.

## Lockstrings and Default Locks
The first check is a direct lock check. The modified LockHandler uses `self.locks.get(access_type, self.obj.get_lockdef(access_type))` to RETRIEVE the lock though, which means the first priority is an explicitly set lock string, and then whatever may be returned by `obj.get_lockdef(access_type)` - if anything. This method will iterate through all `lock_default_funcs` for the object, and return the first one that returns a lock string. If none do, it returns None. The `lock_default_funcs` are set on the typeclass, and are assembled in settings.py - check out the *_DEFAULT_LOCKS entries in athanor._apply_settings for more information. These default-locks may be direct lockstrings or functions/callables that return such.

Default locks are meant to provide an alternative to having explicitly set lockstrings on every object. Athanor's stance is that explicitly set locks should be used only if a particular object is an exception to the norm, and that defaults should be set in settings.py and referenced as needed in place of them or generated by functions.

## Access Checks
The second check is to look for a callable method on the typeclass for `access_check_<access_type>`, which will be called if it exists. (spaces are replaced with underscores.)


## Lock Access Functions
Lastly, a series of `lock_access_funcs` for that access_type are called. These are also set on the typeclass, and are assembled in settings.py - check out the *_ACCESS_FUNCTIONS entries in athanor._apply_settings for more information.